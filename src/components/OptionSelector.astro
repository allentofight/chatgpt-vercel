<!-- GPTOptions.astro -->
---
const options = [
  { title: 'GPT-3.5-turbo(4k)', description: 'GPT 3.5  模型，仅对充值用户提供。此模型支持 4k token（大约 2000 字）的上下文会话' },
  { title: 'new bing(GPT4)', description: '底层基于当今最先进的 GPT-4 模型，new bing 是一个基于人工智能（AI）的搜索引擎，它可以让你用自然语言提出问题，获取完整的答案，进行聊天和创作。新必应不仅提供了可靠、及时的搜索结果，还会引用相关的来源。你可以用简单或复杂的方式提问，跟进，或在聊天中进行优化。新必应会理解你的意图，并给你惊喜的回复。' },
];

let selectedOption = options[0].title;
---

<div class="container">
  <button id="options-button" class="border border-gray-300 px-3 py-1 rounded text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <span id="selected-option-text">{selectedOption}</span>
    <span class="arrow-down">&#9662;</span>
  </button>
  <ul class="options" id="options-list" data-options={JSON.stringify(options)} data-selected={selectedOption} style="display: none;">
  {options.map((option, index) => (
    <li id={`option-${index}`} data-title={option.title} class={`whitespace-nowrap min-w-full border-t border-gray-200 first:border-t-0 ${selectedOption === option.title ? 'bg-gray-100 selected-option' : ''}`}>
      {option.title}
      {selectedOption === option.title ? <span class="inline-block ml-2 text-green-500">&#x2714;</span> : ''}
      <span class="description">{option.description}</span>
    </li>
  ))}
</ul>
</div>

<style>
  .container {
    position: relative;
  }

  .arrow-down {
     margin-left: 8px;
  }

  .options {
    position: absolute;
    background-color: white;
    list-style: none;
    padding: 0;
    margin: 0;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  li {
    padding: 0.5rem 1rem;
    position: relative;
  }
  li:hover {
    background-color: #f3f4f6;
  }
  li:hover ~ li.bg-gray-100 {
    background-color: white;
  }
  .description {
    display: none;
    position: absolute;
    left: 100%;
    top: 0;
    padding: 0.5rem;
    white-space: normal; /* Allow multiple lines for long descriptions */
    min-width: 250px; /* Set a maximum width for the description */
    max-width: 500px; /* Set a maximum width for the description */
    background-color: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  li:hover .description {
    display: block;
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

</style>

<script is:inline>


  const optionsButton = document.getElementById('options-button');
  const optionsList = document.getElementById('options-list');
  const optionItems = optionsList.querySelectorAll('li');

  const optionsData = JSON.parse(optionsList.getAttribute('data-options'));

  // Set the default selected option
  const selectedOptionText = document.getElementById('selected-option-text');
  selectedOptionText.textContent = optionsList.getAttribute('data-selected');


  window.addEventListener('selectOption', (event) => {
    const index = event.detail.index-1;
    const optionObject = optionsData[index];
    const selectedItem = optionsList.querySelector(`#option-${index}`);
    handleClick(optionObject, selectedItem, index);
    if (event.detail.disabled) {
      optionsButton.setAttribute('disabled', event.detail.disabled);
    } else {
      optionsButton.removeAttribute('disabled');
    }
  });


  function handleClick(option, selectedItem, index) {
    const prevSelectedOption = optionsList.getAttribute('data-selected');

    if (prevSelectedOption) {
      const prevSelectedItem = optionsList.querySelector(`[data-title="${prevSelectedOption}"]`);
      prevSelectedItem.classList.remove('bg-gray-100');
      const prevCheckmark = prevSelectedItem.querySelector('.text-green-500');
      if (prevCheckmark) prevCheckmark.remove();
    }

    const newSelectedOption = option.title;
    optionsList.setAttribute('data-selected', newSelectedOption);
    selectedOptionText.textContent = newSelectedOption;

    optionsList.style.display = 'none';

    selectedItem.classList.add('bg-gray-100');
    selectedItem.insertAdjacentHTML('beforeend', '<span class="inline-block ml-2 text-green-500">&#x2714;</span>');

    const event = new CustomEvent('optionSelected', {
      detail: {
        index: index+1
      }
    });
    window.dispatchEvent(event);
  }

  optionsButton.addEventListener('click', (event) => {
    event.stopPropagation();
    optionsList.style.display = optionsList.style.display === 'none' ? 'block' : 'none';
  });

  optionItems.forEach((item, index) => {
    const optionTitle = item.getAttribute('data-title');
    const optionObject = optionsData.find(option => option.title === optionTitle);
    item.addEventListener('click', (event) => {
      event.stopPropagation();
      handleClick(optionObject, item, index);
    });
  });

  window.addEventListener('click', () => {
    optionsList.style.display = 'none';
  });
</script>